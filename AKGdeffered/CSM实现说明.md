# CSM（级联阴影贴图）实现行动清单

## 1. 创建和管理多张 ShadowMap 纹理
- 在 ToyRenderPipeline.cs 等渲染主流程脚本中，声明 RenderTexture 数组用于存储每个级联的 ShadowMap。
- 根据级联数量（如 3~4），在构造函数或初始化阶段创建对应数量的 RenderTexture。

## 2. 设置相机属性以适应每个级联
- 在渲染每个级联 ShadowMap 前，调整光源相机的正交投影参数，使其包围当前级联的视锥体包围盒。
- 保存主相机原始参数，渲染完毕后还原。

## 3. 渲染场景到对应的 ShadowMap
- 对每个级联：
  - 设置渲染目标为当前级联的 ShadowMap。
  - 剔除并绘制所有投射阴影的物体。
  - 渲染完成后，将 ShadowMap 设置为全局纹理，供后续着色器采样。

## 4. 判断物体属于哪个级联视锥体
- 在物体渲染阶段，计算物体与各级联包围盒的关系，确定其属于哪个级联。
- 在着色器中，根据片元深度或世界坐标选择采样对应的 ShadowMap。

## 5. 着色器采样与阴影融合
- 在光照/最终合成 Pass 的 Shader 中，采样对应级联的 ShadowMap，实现阴影效果。
- 支持级联边界平滑过渡（如 PCF、混合等）。

## 6. 调试与优化建议
- 可在场景中可视化各级联包围盒，辅助调试。
- 动态调整级联分布比例，优化阴影质量与性能。

---

> 本文档建议结合 ToyRenderPipeline.cs、CSM.cs、updateCSM.cs 等脚本实现，逐步完善 CSM 渲染流程。